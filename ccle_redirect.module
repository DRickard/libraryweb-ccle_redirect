<?php

function ccle_redirect_menu() {
    $items = array();
    $items['ccle_redirect'] = array(
        'title' => 'CCLE Request Parameters',
        'page callback' => 'ccle_redirect_list',
        'page arguments' => array(1),
        'access arguments' => array('access content'),
        'type' => MENU_NORMAL_ITEM,
     );
    return $items;
}

function ccle_redirect_list() {
  $output = '';

  // Get all entries in the rc_res_rules table.
  if ($entries = ccle_redirect_entry_load()) {
    $rows = array();
    foreach ($entries as $entry) {
      // Sanitize the data before handing it off to the theme layer.
      $rows[] = array_map('check_plain', (array) $entry);
    }
    // Make a table for them.
    $header = array(t('Pid'), t('term'), t('subj_area'), t('crsidx'), t('classidx'), t('lib_guide'));
    $output .= theme('table', array('header' => $header, 'rows' => $rows));
  }
  else {
    drupal_set_message(t('No entries have been added yet.'));
  }
  return $output;
}


/**
 * Read from the database using a filter array.
 *
 */
function ccle_redirect_entry_load($entry = array()) {
  // Read all fields from the rc_res_rules table.
  $select = db_select('ccle_redirect', 'example');
//  $select->condition('user_group', 'Graduate');
  $select->fields('example');

  // Add each field and value as a condition to this query.
  foreach ($entry as $field => $value) {
    $select->condition($field, $value);
  }
  // Return the result in object format.
  return $select->execute()->fetchAll();
}
